import scrapy
from urllib.parse import urlencode
from scrapy.http import Request
from scrapy.selector import Selector
import json
import re
import urllib.parse as urlparse
from urllib.parse import parse_qs
from urllib.parse import parse_qs, urlparse
import pandas as pd
import requests
from sqlalchemy import create_engine
import MySQLdb

class Bse(scrapy.Spider):
    name = 'bse_corp_announcement'

    def start_requests(self):

        headers = {
            'authority': 'api.bseindia.com',
            'pragma': 'no-cache',
            'cache-control': 'no-cache',
            'accept': 'application/json, text/plain, */*',
            'user-agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36',
            'origin': 'https://www.bseindia.com',
            'sec-fetch-site': 'same-site',
            'sec-fetch-mode': 'cors',
            'sec-fetch-dest': 'empty',
            'referer': 'https://www.bseindia.com/stock-share-price/reliance-industries-ltd/reliance/500325/corp-announements/',
            'accept-language': 'en-GB,en-US;q=0.9,en;q=0.8',
        }
        # scrip_code = ['500325']
        scrip_code = ['500002','500003','500008','500009','500010','500012','500013','500014','500016','500020','500023','500027','500028','500029','500031','500032','500033','500034','500038','500039','500040','500041','500042','500043','500048','500049','500052','500055','500058','500059','500060','500067','500068','500069','500074','500078','500083','500084','500085','500086','500087','500089','500092','500093','500096','500097','500101','500102','500103','500104','500106','500108','500109','500110','500111','500112','500113','500114','500116','500117','500119','500120','500123','500124','500125','500126','500128','500133','500135','500136','500142','500143','500144','500147','500148','500150','500151','500153','500155','500159','500160','500163','500164','500165','500166','500168','500170','500171','500173','500174','500179','500180','500182','500183','500184','500185','500186','500187','500188','500189','500191','500192','500193','500199','500201','500202','500206','500207','500209','500210','500211','500212','500213','500214','500215','500219','500220','500223','500227','500228','500231','500233','500234','500235','500236','500238','500239','500240','500241','500243','500245','500246','500247','500248','500249','500250','500251','500252','500253','500254','500257','500259','500260','500264','500265','500266','500267','500268','500271','500274','500277','500279','500280','500284','500285','500288','500290','500292','500294','500295','500296','500298','500300','500302','500304','500306','500307','500312','500313','500314','500317','500319','500325','500327','500329','500330','500331','500333','500335','500336','500337','500338','500339','500343','500346','500350','500354','500355','500356','500357','500358','500360','500365','500366','500367','500368','500370','500378','500380','500387','500388','500390','500399','500400','500402','500403','500404','500405','500407','500408','500410','500411','500412','500413','500414','500418','500420','500422','500425','500426','500429','500439','500440','500444','500449','500450','500456','500458','500459','500460','500463','500464','500467','500469','500470','500472','500477','500480','500483','500488','500490','500493','500495','500500','500510','500520','500530','500540','500547','500550','500570','500575','500620','500645','500650','500655','500660','500670','500672','500674','500676','500680','500690','500696','500710','500730','500770','500777','500780','500790','500800','500820','500825','500830','500840','500850','500870','500875','500877','500878','500890','500940','501110','501111','501144','501148','501150','501151','501242','501261','501270','501295','501298','501301','501311','501314','501343','501351','501370','501386','501391','501421','501423','501425','501430','501455','501477','501622','501630','501700','501831','501833','501848','501945','502015','502090','502137','502157','502168','502175','502180','502216','502219','502250','502281','502294','502330','502355','502420','502445','502448','502450','502460','502563','502587','502589','502742','502820','502850','502865','502873','502893','502901','502933','502937','502958','502986','503015','503031','503100','503101','503127','503162','503169','503229','503310','503349','503622','503624','503635','503639','503641','503657','503659','503663','503669','503671','503675','503681','503689','503691','503696','503722','503772','503776','503804','503806','503811','503816','503831','503837','503863','503893','503960','504000','504008','504028','504036','504058','504067','504076','504080','504084','504092','504093','504112','504132','504176','504180','504212','504220','504240','504258','504273','504286','504335','504340','504341','504346','504351','504356','504360','504365','504375','504378','504380','504390','504392','504397','504398','504605','504614','504646','504648','504673','504697','504717','504731','504741','504746','504786','504810','504840','504879','504882','504908','504918','504959','504961','504966','504973','504988','504998','505010','505029','505036','505075','505141','505160','505163','505192','505196','505200','505212','505216','505230','505232','505242','505250','505255','505283','505285','505299','505302','505320','505324','505336','505355','505358','505368','505400','505412','505504','505506','505509','505515','505523','505526','505533','505537','505576','505583','505585','505590','505594','505650','505658','505681','505685','505688','505690','505693','505700','505703','505710','505711','505712','505714','505720','505725','505726','505729','505737','505744','505750','505790','505800','505807','505827','505840','505850','505854','505872','505890','505893','505978','506003','506022','506024','506074','506076','506079','506087','506105','506107','506109','506120','506122','506128','506134','506142','506146','506161','506162','506166','506178','506180','506184','506186','506190','506194','506196','506197','506222','506235','506248','506260','506261','506285','506313','506365','506390','506395','506401','506405','506414','506480','506520','506522','506525','506528','506530','506532','506543','506579','506590','506597','506605','506618','506640','506642','506655','506685','506687','506690','506734','506767','506808','506820','506852','506854','506858','506863','506867','506879','506906','506910','506919','506935','506943','506945','506947','506975','506981','507155','507180','507205','507265','507300','507315','507410','507435','507438','507442','507450','507474','507486','507488','507490','507498','507508','507514','507515','507522','507525','507526','507543','507552','507580','507598','507609','507621','507645','507685','507690','507717','507747','507753','507759','507779','507785','507789','507794','507808','507813','507815','507817','507828','507836','507852','507864','507872','507878','507880','507886','507894','507910','507912','507917','507938','507944','507946','507948','507952','507960','507962','507966','507970','507981','507987','507998','508136','508306','508486','508494','508571','508664','508670','508807','508814','508867','508869','508875','508905','508906','508918','508922','508924','508929','508933','508941','508954','508956','508961','508963','508969','508980','508989','508993','508996','509003','509009','509015','509020','509026','509038','509040','509046','509048','509051','509053','509055','509069','509073','509077','509079','509084','509099','509148','509152','509162','509196','509220','509243','509423','509438','509449','509470','509472','509480','509486','509488','509496','509525','509546','509557','509563','509567','509597','509631','509635','509650','509675','509692','509709','509715','509760','509782','509820','509835','509845','509870','509874','509887','509895','509910','509917','509930','509945','509953','509966','510245','511000','511012','511018','511034','511048','511060','511066','511072','511074','511076','511096','511108','511110','511116','511122','511131','511138','511139','511147','511149','511153','511169','511176','511185','511187','511196','511200','511208','511218','511243','511254','511260','511333','511355','511359','511367','511377','511389','511391','511401','511411','511413','511427','511431','511441','511447','511451','511463','511473','511493','511501','511505','511507','511509','511523','511525','511533','511535','511539','511543','511549','511551','511557','511559','511571','511577','511585','511589','511593','511597','511601','511605','511609','511611','511618','511626','511628','511630','511634','511654','511658','511664','511672','511676','511688','511692','511696','511700','511702','511706','511710','511712','511714','511716','511724','511726','511728','511730','511736','511738','511740','511742','511754','511756','511758','511760','511764','511766','511768','512004','512008','512011','512014','512018','512020','512022','512025','512026','512036','512038','512047','512048','512060','512062','512063','512064','512065','512068','512070','512091','512093','512099','512101','512103','512105','512109','512117','512131','512149','512153','512157','512161','512165','512169','512175','512179','512195','512197','512213','512215','512217','512221','512229','512237','512245','512247','512257','512261','512267','512271','512277','512279','512289','512291','512296','512297','512301','512303','512329','512337','512341','512344','512345','512359','512367','512377','512379','512381','512393','512399','512404','512405','512408','512415','512425','512433','512437','512441','512445','512453','512455','512461','512463','512477','512479','512481','512485','512487','512489','512493','512499','512511','512519','512522','512527','512529','512531','512553','512559','512565','512573','512587','512589','512591','512595','512597','512599','512600','512604','512608','512618','512624','512626','512634','513005','513010','513023','513039','513043','513059','513063','513097','513108','513117','513119','513121','513142','513149','513151','513173','513179','513216','513228','513250','513252','513262','513269','513291','513295','513303','513305','513307','513309','513335','513343','513349','513353','513359','513361','513369','513375','513377','513397','513401','513403','513414','513418','513422','513430','513434','513436','513446','513452','513456','513460','513472','513488','513496','513498','513502','513507','513509','513511','513513','513515','513517','513519','513528','513532','513536','513540','513544','513548','513554','513558','513566','513579','513599','513605','513642','513683','513687','513691','513693','513699','513709','513713','513721','513723','513729','514010','514028','514030','514034','514036','514043','514045','514060','514087','514113','514128','514138','514140','514142','514144','514162','514165','514167','514171','514175','514183','514197','514211','514215','514223','514234','514236','514238','514240','514248','514264','514266','514272','514274','514280','514286','514300','514302','514312','514316','514318','514322','514324','514326','514330','514332','514336','514348','514354','514358','514360','514378','514386','514394','514400','514402','514412','514418','514428','514440','514442','514448','514450','514454','514460','514470','514482','514486','515030','515037','515043','515055','515059','515085','515093','515127','515145','515147','516003','516007','516016','516020','516022','516030','516032','516062','516064','516072','516078','516082','516086','516092','516096','516098','516106','516108','516110','517015','517035','517041','517044','517059','517063','517077','517080','517096','517119','517146','517166','517168','517170','517172','517174','517201','517206','517214','517224','517230','517236','517238','517246','517258','517264','517271','517273','517288','517300','517320','517330','517334','517344','517354','517356','517360','517370','517372','517380','517385','517393','517397','517399','517411','517415','517417','517421','517429','517431','517437','517447','517449','517463','517467','517477','517494','517498','517500','517506','517514','517522','517530','517536','517544','517546','517548','517554','517562','517569','517571','518011','518029','518075','518091','519003','519014','519031','519064','519091','519097','519105','519126','519136','519152','519156','519174','519183','519191','519214','519216','519224','519230','519234','519238','519242','519248','519260','519262','519279','519285','519287','519295','519299','519307','519319','519331','519353','519359','519367','519383','519397','519413','519415','519421','519439','519455','519457','519463','519471','519475','519477','519483','519491','519494','519500','519506','519532','519552','519566','519588','519600','519602','519604','519606','519612','520008','520021','520043','520051','520056','520057','520059','520066','520073','520075','520081','520086','520111','520113','520119','520121','520123','520127','520131','520141','520151','520155','521003','521014','521016','521018','521034','521036','521054','521062','521064','521068','521070','521080','521082','521097','521105','521109','521113','521131','521133','521137','521141','521149','521151','521161','521163','521167','521178','521180','521182','521188','521194','521200','521206','521210','521216','521220','521222','521226','521228','521232','521234','521240','521242','521244','521248','522001','522004','522005','522014','522017','522027','522029','522034','522036','522064','522073','522074','522091','522101','522105','522108','522113','522122','522134','522152','522163','522165','522171','522183','522195','522205','522207','522209','522215','522217','522229','522231','522237','522241','522245','522249','522251','522257','522261','522263','522267','522273','522275','522281','522285','522287','522289','522292','522294','522295','522650','523007','523011','523019','523021','523023','523025','523054','523062','523100','523105','523113','523116','523120','523127','523144','523151','523160','523164','523186','523204','523207','523222','523229','523232','523242','523248','523260','523261','523269','523277','523283','523289','523301','523315','523319','523323','523329','523343','523351','523367','523369','523371','523373','523384','523385','523391','523395','523398','523405','523411','523419','523425','523445','523449','523457','523465','523475','523483','523489','523519','523537','523539','523550','523558','523566','523574','523586','523594','523598','523606','523610','523618','523620','523628','523630','523638','523642','523648','523650','523652','523660','523672','523676','523694','523696','523704','523708','523710','523712','523716','523736','523752','523754','523756','523782','523790','523792','523796','523826','523828','523832','523836','523838','523840','523842','523844','523850','523862','523874','523888','523896','524000','524013','524019','524031','524037','524038','524051','524075','524080','524091','524109','524129','524136','524156','524164','524174','524200','524202','524208','524210','524212','524218','524226','524230','524280','524288','524314','524322','524324','524330','524332','524336','524342','524348','524370','524394','524396','524400','524404','524408','524412','524414','524434','524440','524444','524458','524470','524480','524488','524494','524500','524502','524506','524514','524516','524518','524520','524522','524534','524542','524558','524564','524570','524572','524576','524580','524582','524592','524594','524598','524604','524606','524610','524614','524624','524628','524632','524634','524640','524642','524648','524652','524654','524661','524663','524667','524669','524675','524687','524699','524703','524709','524711','524715','524717','524723','524727','524731','524735','524742','524743','524748','524752','524758','524764','524768','524774','524790','524804','524808','524816','524818','524820','524824','524828','526001','526025','526027','526043','526071','526073','526081','526093','526095','526113','526115','526117','526125','526133','526137','526139','526143','526159','526161','526169','526173','526179','526187','526193','526195','526211','526217','526225','526227','526231','526235','526237','526241','526247','526251','526263','526269','526299','526301','526315','526325','526335','526349','526355','526365','526367','526371','526373','526381','526397','526407','526409','526415','526423','526431','526433','526435','526441','526445','526471','526473','526477','526479','526481','526488','526490','526492','526494','526500','526504','526506','526519','526521','526525','526532','526538','526544','526546','526550','526554','526568','526570','526574','526576','526582','526586','526588','526596','526604','526608','526612','526614','526616','526622','526628','526638','526640','526642','526650','526654','526662','526666','526668','526683','526689','526703','526705','526707','526711','526717','526721','526723','526725','526727','526729','526731','526737','526739','526747','526751','526761','526775','526783','526795','526797','526799','526801','526807','526813','526817','526821','526823','526827','526829','526839','526847','526849','526851','526853','526859','526861','526871','526881','526885','526887','526891','526899','526901','526905','526917','526921','526927','526931','526935','526945','526947','526951','526953','526957','526959','526961','526965','526967','526971','526977','526981','526983','526987','527001','527005','530001','530005','530007','530011','530017','530019','530023','530025','530035','530037','530043','530045','530047','530053','530055','530057','530063','530065','530067','530073','530075','530077','530079','530095','530109','530111','530117','530119','530125','530127','530129','530131','530133','530135','530139','530141','530145','530149','530151','530161','530163','530167','530169','530171','530173','530175','530177','530179','530185','530187','530191','530197','530199','530201','530207','530213','530215','530219','530231','530233','530235','530239','530245','530249','530253','530255','530259','530263','530265','530267','530271','530281','530289','530291','530299','530305','530307','530309','530313','530315','530317','530331','530341','530343','530355','530357','530361','530363','530365','530367','530369','530377','530393','530401','530403','530405','530407','530419','530421','530427','530429','530431','530433','530441','530443','530445','530449','530457','530459','530461','530469','530475','530477','530495','530499','530517','530521','530525','530533','530537','530543','530545','530549','530555','530557','530565','530571','530577','530579','530581','530585','530589','530595','530601','530609','530611','530615','530617','530621','530627','530643','530655','530663','530665','530669','530675','530677','530683','530689','530695','530697','530699','530705','530709','530711','530713','530715','530723','530733','530735','530741','530747','530755','530759','530765','530771','530777','530779','530783','530787','530789','530795','530797','530799','530803','530805','530807','530809','530813','530815','530821','530825','530829','530839','530841','530843','530845','530853','530859','530871','530879','530881','530883','530889','530897','530899','530907','530909','530915','530917','530919','530925','530929','530931','530943','530951','530953','530959','530961','530965','530973','530977','530979','530985','530991','530993','530997','530999','531003','531017','531025','531027','531033','531035','531041','531043','531049','531051','531065','531067','531069','531080','531082','531083','531088','531091','531092','531099','531109','531111','531112','531119','531120','531126','531127','531129','531137','531146','531147','531155','531156','531157','531158','531161','531162','531163','531164','531169','531172','531173','531176','531178','531179','531190','531192','531196','531198','531199','531201','531203','531205','531209','531210','531211','531212','531213','531215','531216','531219','531221','531223','531225','531227','531228','531233','531234','531235','531237','531241','531246','531252','531253','531254','531255','531257','531259','531260','531266','531268','531272','531273','531274','531278','531279','531280','531281','531283','531287','531288','531289','531297','531300','531301','531304','531306','531307','531310','531314','531319','531322','531323','531324','531328','531334','531335','531336','531337','531338','531339','531340','531341','531343','531344','531346','531349','531352','531357','531358','531359','531360','531364','531370','531373','531380','531381','531387','531390','531395','531397','531398','531400','531402','531404','531406','531409','531411','531412','531413','531416','531417','531426','531429','531431','531433','531436','531437','531439','531444','531447','531449','531453','531454','531456','531460','531465','531471','531472','531489','531494','531495','531496','531497','531499','531500','531502','531503','531505','531506','531508','531509','531512','531515','531518','531521','531525','531531','531533','531539','531540','531541','531543','531548','531550','531552','531553','531556','531557','531560','531569','531574','531578','531582','531583','531585','531591','531592','531594','531595','531599','531600','531608','531609','531613','531616','531621','531624','531626','531628','531633','531635','531637','531638','531640','531642','531644','531648','531651','531652','531658','531661','531663','531667','531668','531672','531673','531676','531677','531680','531681','531687','531688','531692','531694','531717','531719','531723','531726','531727','531735','531737','531739','531743','531744','531746','531752','531758','531761','531762','531768','531771','531775','531778','531780','531784','531795','531797','531802','531810','531813','531814','531819','531821','531822','531832','531834','531841','531842','531845','531846','531847','531859','531861','531862','531867','531869','531870','531878','531879','531881','531882','531885','531888','531889','531892','531893','531900','531902','531909','531910','531911','531913','531917','531918','531921','531923','531928','531929','531930','531931','531936','531944','531946','531950','531952','531962','531968','531971','531972','531977','531978','531979','531980','531982','531989','531991','531994','531996','532001','532005','532007','532011','532015','532016','532022','532029','532033','532035','532038','532039','532041','532042','532051','532053','532054','532056','532057','532067','532070','532078','532081','532083','532090','532092','532097','532100','532102','532105','532113','532114','532123','532124','532129','532134','532140','532141','532143','532144','532145','532149','532150','532154','532155','532156','532159','532160','532162','532163','532164','532167','532172','532173','532174','532175','532178','532180','532181','532183','532187','532189','532209','532210','532212','532215','532216','532217','532218','532219','532221','532230','532234','532240','532256','532259','532262','532268','532271','532281','532282','532284','532285','532286','532290','532296','532300','532301','532304','532305','532307','532309','532310','532313','532320','532321','532323','532324','532326','532329','532330','532331','532333','532334','532339','532340','532341','532343','532344','532345','532348','532349','532350','532351','532354','532355','532356','532357','532359','532362','532365','532366','532368','532369','532370','532371','532372','532373','532374','532375','532376','532378','532379','532380','532382','532384','532386','532387','532388','532390','532391','532392','532395','532397','532398','532400','532402','532403','532404','532406','532407','532408','532410','532413','532416','532419','532424','532425','532430','532432','532435','532439','532440','532441','532443','532444','532454','532455','532456','532457','532459','532460','532461','532466','532467','532468','532470','532475','532477','532478','532479','532481','532482','532483','532485','532486','532488','532493','532497','532498','532500','532503','532504','532505','532507','532508','532509','532513','532514','532515','532521','532522','532523','532524','532525','532527','532528','532529','532531','532532','532538','532539','532540','532541','532543','532548','532553','532555','532604','532605','532610','532612','532613','532614','532616','532617','532621','532622','532624','532626','532627','532628','532629','532630','532633','532636','532637','532638','532641','532642','532644','532645','532646','532648','532649','532650','532651','532652','532654','532656','532658','532659','532660','532661','532662','532663','532666','532667','532668','532670','532673','532674','532678','532679','532683','532684','532686','532687','532689','532690','532692','532693','532694','532695','532696','532698','532699','532700','532701','532702','532705','532706','532707','532708','532710','532712','532713','532714','532716','532717','532719','532720','532721','532722','532723','532725','532726','532728','532729','532730','532731','532732','532733','532734','532735','532737','532738','532740','532741','532742','532744','532745','532746','532748','532749','532751','532754','532755','532756','532757','532759','532760','532761','532762','532764','532766','532767','532768','532771','532772','532773','532774','532775','532776','532777','532779','532780','532782','532783','532784','532785','532790','532794','532795','532796','532797','532798','532799','532800','532801','532804','532805','532806','532807','532808','532809','532810','532811','532812','532813','532814','532815','532817','532819','532820','532822','532823','532825','532826','532827','532828','532829','532830','532832','532834','532835','532839','532841','532842','532843','532845','532847','532848','532850','532851','532852','532853','532854','532855','532856','532859','532864','532865','532867','532868','532869','532870','532872','532873','532874','532875','532878','532879','532880','532884','532885','532886','532887','532888','532889','532890','532891','532892','532893','532894','532895','532896','532898','532899','532900','532902','532904','532906','532907','532911','532914','532915','532916','532918','532920','532921','532922','532923','532924','532925','532926','532927','532928','532929','532930','532931','532932','532933','532934','532935','532937','532939','532940','532941','532942','532944','532945','532946','532947','532951','532952','532953','532955','532957','532959','532960','532966','532967','532972','532974','532975','532976','532977','532978','532980','532983','532985','532986','532987','532988','532989','532990','532992','532993','532994','532997','532998','533001','533006','533007','533008','533012','533014','533018','533019','533022','533023','533029','533033','533047','533048','533056','533078','533080','533088','533090','533095','533096','533098','533101','533104','533106','533107','533108','533109','533110','533121','533122','533137','533138','533144','533146','533148','533149','533150','533151','533152','533155','533156','533157','533158','533160','533161','533162','533163','533164','533166','533167','533168','533169','533170','533176','533177','533178','533179','533181','533189','533192','533193','533200','533202','533204','533206','533207','533208','533210','533211','533212','533213','533216','533217','533218','533221','533227','533229','533239','533248','533252','533257','533259','533260','533261','533262','533263','533265','533267','533268','533269','533270','533271','533272','533273','533274','533275','533278','533282','533284','533285','533286','533287','533289','533292','533293','533294','533295','533296','533298','533301','533302','533303','533306','533310','533315','533316','533317','533320','533321','533326','533329','533333','533336','533339','533343','533344','533393','533398','533400','533407','533411','533427','533451','533452','533470','533477','533482','533506','533519','533520','533540','533543','533552','533553','533573','533576','533581','533602','533605','533608','533629','533632','533638','533644','533655','533676','533704','533758','533761','533896','533941','533982','534060','534063','534064','534076','534091','534109','534139','534190','534309','534312','534328','534338','534369','534392','534422','534425','534532','534535','534563','534597','534598','534600','534612','534615','534618','534623','534639','534659','534674','534675','534680','534690','534691','534707','534731','534732','534733','534742','534748','534755','534758','534796','534804','534809','534816','534976','535136','535204','535205','535267','535276','535279','535322','535387','535431','535458','535566','535601','535602','535620','535621','535647','535648','535657','535667','535693','535719','535730','535754','535755','535789','535910','535916','535917','535958','536170','536264','536456','536493','536507','536565','536659','536672','536709','536710','536737','536738','536751','536773','536868','536960','536965','536974','537007','537008','537092','537253','537254','537259','537291','537292','537326','537392','537483','537492','537524','537536','537573','537582','537669','537707','537708','537750','537766','537784','537785','537800','537820','537839','537840','538019','538057','538081','538092','538119','538128','538180','538212','538268','538273','538319','538365','538382','538395','538401','538402','538432','538433','538446','538451','538452','538464','538465','538476','538496','538501','538502','538521','538539','538540','538542','538546','538556','538557','538562','538563','538564','538565','538566','538567','538568','538569','538576','538577','538578','538579','538596','538597','538598','538607','538609','538610','538611','538634','538635','538646','538647','538652','538653','538666','538667','538668','538674','538683','538684','538685','538706','538707','538708','538709','538710','538711','538712','538713','538714','538715','538716','538728','538729','538730','538731','538732','538733','538734','538742','538765','538770','538772','538777','538778','538786','538787','538788','538789','538794','538795','538808','538809','538810','538811','538812','538817','538833','538834','538835','538836','538837','538838','538858','538860','538862','538863','538868','538874','538875','538881','538882','538890','538891','538894','538895','538896','538897','538902','538918','538919','538920','538921','538922','538923','538926','538928','538935','538942','538943','538961','538962','538964','538965','538970','538975','538979','538987','538992','538993','539005','539006','539009','539011','539012','539013','539015','539016','539017','539018','539026','539031','539032','539041','539042','539043','539044','539045','539046','539056','539083','539090','539091','539097','539098','539099','539110','539111','539112','539113','539114','539115','539116','539117','539118','539119','539120','539121','539122','539124','539126','539132','539141','539142','539143','539148','539149','539150','539151','539174','539175','539176','539177','539195','539196','539197','539198','539199','539201','539206','539207','539216','539217','539218','539219','539220','539221','539222','539223','539224','539225','539226','539227','539228','539229','539230','539235','539246','539251','539252','539253','539254','539255','539265','539267','539268','539273','539274','539275','539276','539277','539278','539285','539286','539287','539288','539289','539290','539291','539300','539301','539302','539303','539304','539309','539310','539311','539312','539313','539314','539331','539332','539334','539336','539337','539346','539351','539352','539353','539354','539359','539363','539378','539383','539384','539391','539393','539398','539399','539400','539401','539402','539403','539404','539405','539406','539407','539408','539409','539410','539428','539433','539434','539435','539436','539437','539447','539448','539449','539450','539455','539468','539469','539470','539479','539480','539481','539487','539488','539492','539493','539494','539495','539506','539515','539516','539517','539518','539519','539520','539521','539522','539523','539524','539525','539526','539527','539528','539533','539542','539543','539544','539545','539546','539551','539552','539559','539560','539561','539562','539570','539574','539584','539593','539594','539596','539597','539598','539599','539600','539607','539620','539621','539632','539636','539637','539658','539659','539660','539661','539662','539669','539673','539678','539679','539680','539681','539682','539683','539686','539692','539697','539724','539725','539730','539742','539760','539762','539770','539773','539784','539785','539787','539788','539798','539799','539800','539807','539814','539819','539833','539834','539835','539837','539839','539841','539843','539844','539854','539861','539871','539872','539874','539875','539876','539883','539884','539889','539894','539895','539909','539910','539917','539921','539922','539927','539938','539939','539940','539945','539946','539947','539956','539957','539963','539978','539979','539980','539981','539982','539984','539985','539986','539991','539992','539997','540005','540006','540008','540023','540024','540025','540026','540027','540047','540048','540061','540062','540064','540065','540066','540071','540072','540073','540078','540079','540080','540081','540082','540083','540084','540097','540108','540115','540124','540125','540132','540133','540134','540135','540136','540143','540144','540145','540146','540147','540148','540150','540151','540152','540153','540154','540159','540168','540173','540174','540175','540180','540181','540190','540192','540194','540195','540196','540197','540198','540199','540203','540204','540205','540210','540211','540212','540221','540222','540243','540248','540249','540250','540251','540252','540253','540254','540259','540266','540267','540268','540269','540270','540293','540310','540311','540318','540332','540333','540334','540335','540336','540358','540359','540360','540361','540366','540376','540377','540378','540379','540381','540383','540385','540386','540393','540395','540396','540401','540402','540403','540404','540405','540416','540417','540418','540419','540420','540421','540422','540423','540424','540425','540426','540455','540467','540468','540469','540470','540481','540492','540497','540515','540519','540530','540538','540539','540544','540545','540550','540551','540552','540570','540575','540586','540587','540588','540589','540590','540591','540592','540593','540594','540595','540596','540597','540602','540611','540612','540613','540614','540615','540617','540618','540619','540620','540621','540626','540627','540629','540631','540634','540635','540636','540637','540642','540647','540648','540649','540650','540651','540652','540653','540654','540669','540671','540672','540673','540678','540679','540680','540681','540682','540683','540684','540685','540686','540691','540692','540693','540694','540695','540696','540697','540699','540700','540701','540702','540703','540704','540709','540710','540711','540712','540713','540714','540715','540716','540717','540718','540719','540724','540725','540726','540727','540728','540729','540730','540735','540736','540737','540738','540739','540740','540741','540742','540743','540744','540749','540750','540755','540756','540757','540758','540759','540760','540761','540762','540763','540764','540765','540766','540767','540768','540769','540774','540775','540776','540777','540778','540779','540780','540781','540782','540786','540787','540788','540789','540791','540792','540793','540794','540795','540796','540797','540798','540799','540800','540801','540802','540809','540811','540812','540821','540823','540824','540825','540826','540827','540828','540829','540843','540850','540861','540862','540863','540864','540879','540896','540897','540898','540899','540900','540901','540902','540903','540904','540914','540923','540935','540936','540937','540938','540945','540947','540949','540950','540951','540952','540953','540954','540955','540956','540961','540975','540980','540981','540982','540983','540984','541005','541006','541019','541053','541068','541069','541070','541071','541083','541084','541085','541086','541087','541092','541093','541094','541095','541096','541112','541133','541143','541144','541151','541152','541153','541154','541161','541163','541167','541178','541179','541195','541196','541206','541228','541233','541252','541253','541254','541255','541269','541276','541299','541301','541302','541303','541304','541309','541310','541311','541312','541313','541336','541337','541338','541341','541343','541345','541346','541347','541352','541353','541358','541400','541401','541402','541403','541418','541444','541445','541450','541503','541540','541545','541546','541556','541557','541578','541601','541627','541633','541634','541672','541673','541674','541675','541676','541677','541678','541679','541700','541701','541702','541703','541725','541726','541727','541728','541729','541735','541741','541742','541743','541744','541745','541770','541771','541778','541799','541804','541805','541806','541807','541809','541865','541879','541881','541882','541884','541890','541929','541945','541956','541967','541972','541973','541974','541983','541984','541985','541986','541987','541988','542002','542011','542012','542013','542019','542020','542025','542034','542046','542057','542066','542117','542123','542131','542141','542145','542146','542155','542156','542158','542160','542163','542176','542206','542216','542230','542231','542232','542233','542244','542245','542246','542247','542248','542285','542323','542332','542333','542337','542351','542367','542376','542377','542383','542399','542437','542446','542459','542460','542477','542484','542503','542513','542524','542544','542579','542580','542592','542597','542599','542627','542628','542641','542649','542650','542651','542652','542653','542654','542655','542665','542666','542667','542668','542669','542670','542677','542678','542679','542682','542683','542684','542685','542694','542721','542724','542725','542726','542727','542728','542729','542730','542747','542752','542753','542758','542759','542760','542771','542772','542773','542774','542801','542802','542803','542804','542805','542806','542807','542808','542809','542810','542811','542812','542813','542814','542815','542816','542817','542818','542819','542820','542830','542836','542837','542838','542839','542840','542841','542842','542843','542844','542845','542846','542847','542848','542849','542850','542851','542852','542857','542862','542863','542864','542865','542866','542867','542904','542905','542906','542907','542911','542918','542919','542920','542921','542922','542924','542931','542932','542933','542934','542935','542938','543064','543065','543066','543144','543145','543146','543147','543148','543149','543150','543151','543152','543153','543154','543155','543156','543168','543169','543170','543171','543172','543173','543174','543175','543176','543177','543178','543179','543180','543181','543182','543183','543184','543185','543186','543187','555555','570001','570002','570004','570005','580001','590003','590005','590006','590013','590018','590021','590022','590024','590025','590030','590031','590043','590051','590056','590057','590062','590065','590066','590070','590071','590072','590073','590075','590078','590082','590086','590103','590104','590106','590107','590108','590109','590110','590115','590122','590134','700005','700006','700010','700018','700028','700061','700062','700063','700064','700065','700091','710028','780004','780006','780007','780008','780009','780012','780013','780014','780015','780016','780019']
        for code in scrip_code:    
            params = (
                ('strCat', '-1'),
                ('strPrevDate', '20100101'),
                ('strScrip', code),
                ('strSearch', 'A'),
                ('strToDate', '20200603'),
                ('strType', 'C'),
            )
            url = 'https://api.bseindia.com/BseIndiaAPI/api/AnnGetData/w?'+urlencode(params)
            yield Request(url, callback = self.parse, headers=headers)

    def parse(self, response):
        res = json.loads(response.text)
        data1 = pd.DataFrame()
        for i in range(len(res['Table'])):
            x = res['Table'][i].keys()
            r={}
            for key in x:
                if key == 'ATTACHMENTNAME':
                    if res['Table'][i][key] != '':
                        r[key] = 'https://www.bseindia.com/xml-data/corpfiling/AttachHis/'+res['Table'][i][key]
                        # self.download_pdf(r[key])
                    else:
                        r[key] = res['Table'][i][key]
                    
                else:
                    r[key] = res['Table'][i][key]
                
            data1 = data1.append(r, ignore_index=True)
        conn = MySQLdb.connect(db ='bse', host='localhost', user='mca', passwd='H3@drunMcaMy07', charset="utf8", use_unicode=True)
        cur = conn.cursor()
        cur.execute('truncate corp_announcement')
        column_names = data1.columns.to_list()
        for i in range(len(data1)):
            column_values = tuple(data1.iloc[i].values)
            values_ = ['%s']* len(column_names)
            query  = "insert ignore into corp_announcement  ({0}) values ({1})".format(','.join(column_names), (('%s,')*len(column_names)).strip(','))
            cur.execute(query, column_values)
            conn.commit()
        cur.close()
        conn.close()

    def download_pdf(self, url):
        get_response = requests.get(url,stream=True)
        file_name  = url.split("/")[-1]
        file_path = '/home/headrun/anandhu/projects/BSE_Corp_Announcement/' + file_name
        with open(file_path, 'wb') as f:
            for chunk in get_response.iter_content(chunk_size=1024):
                if chunk: 
                    f.write(chunk)
